{% extends 'base.html' %}

{% block title %}{{ submission.title }} - FileForum{% endblock %}

{% block content %}
    <div class="content-header">
        <h2>{{ submission.title }}</h2>
        <p class="submission-meta">
            Submitted on {{ submission.created_at|date:"F d, Y" }} by
            <strong>{{ submission.owner.username }}</strong>
        </p>
    </div>

    <div class="submission-content">
        <p>{{ submission.description|linebreaks }}</p>

        <h4>Files ({{ submission.files.count }})</h4>
        <ul>
            {% for file in submission.files.all %}
                <li><a href="{{ file.file.url }}" download>{{ file.file.name|cut:"submissions/" }}</a></li>
            {% empty %}
                <li>No files have been uploaded to this submission.</li>
            {% endfor %}
        </ul>
    </div>

    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #ccc;">

    <div class="comments-section">
        <h3>Comments</h3>
        <!-- Comment form for authenticated users -->
        {% if user.is_authenticated %}
            <form action="#" method="post">
                {% csrf_token %}
                <textarea name="content" rows="4" style="width: 100%;" placeholder="Leave a comment..."></textarea>
                <br>
                <button type="submit" class="nav-button" style="margin-top: 10px;">Post Comment</button>
            </form>
        {% else %}
            <p><a href="#">Log in</a> to post a comment.</p>
        {% endif %}

        <!-- Display existing comments -->
        <div class="comment-list" style="margin-top: 20px;">
            {% for comment in submission.comments.all %}
                {% if not comment.parent %}
                    <div class="comment" style="margin-bottom: 15px; border-left: 2px solid #ddd; padding-left: 15px;">
                        <p><strong>{{ comment.author.username }}</strong> <span style="color: #888; font-size: 12px;">on {{ comment.created_at|date:"M d, Y" }}</span></p>
                        <p>{{ comment.content|linebreaks }}</p>
                    </div>
                {% endif %}
            {% empty %}
                <p>No comments yet.</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}
